extends ../layout

block stylesheets
  link(href="/stylesheets/vendor/bootstrap-build/bootstrap.min.css", type='text/css', rel="stylesheet")
  link(href="/stylesheets/vendor/bootstrap-build/bootstrap-responsive.min.css", type='text/css', rel="stylesheet")
  link(href="http://fonts.googleapis.com/css?family=Share:400,700", type='text/css', rel="stylesheet")
  link(href="/stylesheets/style.css", type='text/css', rel="stylesheet")

block scripts
  script(src="/javascripts/vendor/bootstrap/bootstrap.min.js", type="text/javascript")
  script(src="/javascripts/functions.utils.js", type="text/javascript")
  script(src="/javascripts/courses.js", type="text/javascript")
  script(src="/javascripts/mission.js", type="text/javascript")

block body

  include ../layouts/menu
  .page-header
    .container
      h1
        a(href=_("/courses/") + course.slug)=course.title
        =" › "
        a(href=_("/courses/") + course.slug + "/" + chapter.slug)=chapter.title
        =" › Mission"
      p=mission.config.description
      
  .container
    .row
      //- chapter.content must be read as an HTML content
      .span9
        form(method="POST", class="mission-"+mission.type, data-type=mission.type, data-state=mission.state)#mission          
          .well
            !=mission.getContent();   

            if mission.state == "game"
              .splashscreen( data-msg-cd-plural=_("The mission is about to begin in % seconds."), data-msg-cd-single=_("The mission is about to begin in % second.") )
                .countdown
                .instruction=_("Push a button to select an answer")       

          //- Hides the quiz navigation toolbar 
          //- if we are not playing a classic game 
          if mission.type == "classic" || mission.state != "game"
            .well.well-small
              .row              
                case mission.state
                  
                  when "game"
                    .pull-right
                      button.btn.btn-primary(type="submit")
                        =_("Next")
                        i.icon-arrow-right.icon-white.left05
                  
                  when "success"
                    .span3.tl                      
                      a.btn.btn-primary(href=_("/courses/") + course.slug + "/" + chapter.slug )
                        i.icon-arrow-left.icon-white.right05
                        =_("Read the chapter again")  
                    .span3.tc 
                      button.btn(type="submit")                       
                        i.icon-repeat.right05                      
                        =_("Play again")
                    if(nextChapter)
                      .pull-right
                        a.btn.btn-primary(href=_("/courses/") + course.slug + "/" + nextChapter.slug)
                          =_("Next chapter")
                          i.icon-arrow-right.icon-white.left05

                  when "failed"
                    .span3.tl                      
                      a.btn.btn-primary(href=_("/courses/") + course.slug + "/" + chapter.slug )
                        i.icon-arrow-left.icon-white.right05
                        =_("Read the chapter again")                
                    .span3.tc
                      button.btn(type="submit")
                        i.icon-repeat.right05                      
                        =_("Try again")
                  
              .clearfix
      .span3
        include ../layouts/progress-menu

  //- Must be in a relative block for a relative js overlay  
  .my-journey-head
    .container
      h2=_("My journey")
      //- Dynamicly completed
      .my-journey.row.top20(data-course=course.slug)

    
        
  include ../layouts/footer